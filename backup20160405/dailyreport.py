 # -*- coding: utf-8 -*-import confimport timeimport MySQLdbdef conndb():    return MySQLdb.connect(host = conf.mysql_host, user = conf.mysql_user, passwd = conf.mysql_pwd, db = conf.mysql_db, port = int(conf.mysql_port))def updateDailyReport(currdate):    conn = conndb()    cursor = conn.cursor()    try:        cursor.execute('set names utf8')        selectSql  = "select id from daily_report where date = %s "        res = cursor.execute(selectSql,(currdate))        print(res)        if(True != res):            sql = "INSERT INTO daily_report(`date`) values(%s); "            n = cursor.execute(sql,(currdate))            print("新增记录成功: %s" % cursor.lastrowid)        else:            pass        sql1 = 'UPDATE daily_report SET uuidNum  = (SELECT COUNT(*) FROM act_flow0  WHERE daily_report.date = act_flow0.date  GROUP BY `date`)  WHERE  daily_report.date = ' + "'"+currdate+ "'" ;        sql2 = 'UPDATE daily_report SET uuidCount = (SELECT COUNT(DISTINCT(`uuid`)) FROM act_flow0  WHERE daily_report.date = act_flow0.date  GROUP BY act_flow0.`date`) WHERE  daily_report.date = ' + "'"+currdate+ "'" ;        sql3 = 'UPDATE daily_report SET userNum  = (SELECT COUNT(*) FROM `user` WHERE daily_report.date = DATE_FORMAT(user.created_at ,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(user.created_at ,\'%Y-%m-%d\') ) WHERE  daily_report.date = ' + "'"+currdate+ "'" ;        sql4 = 'UPDATE daily_report SET programmerNum  = (SELECT COUNT(*) FROM `user` left join user_profile on user.user_id = user_profile.user_id WHERE daily_report.date = DATE_FORMAT(user.created_at ,\'%Y-%m-%d\') AND user_profile.user_id is not null  GROUP BY DATE_FORMAT(user.created_at ,\'%Y-%m-%d\') ) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql5 = 'UPDATE daily_report SET bossNum  = (SELECT COUNT(*) FROM `user` left join user_profile on user.user_id = user_profile.user_id WHERE daily_report.date = DATE_FORMAT(user.created_at ,\'%Y-%m-%d\') AND  user_profile.user_id is  null  GROUP BY DATE_FORMAT(user.created_at ,\'%Y-%m-%d\') ) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql6 = 'UPDATE daily_report SET send_bespeak  = (SELECT COUNT(*) FROM `bespeak` WHERE bespeak.type <> 1 and daily_report.date = DATE_FORMAT(bespeak.created_at ,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(bespeak.created_at ,\'%Y-%m-%d\') ) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql7 = 'UPDATE daily_report SET agree_bespeak  = (SELECT COUNT(*) FROM `bespeak` WHERE bespeak.type <> 1 and  daily_report.date = DATE_FORMAT(bespeak.updated_at ,\'%Y-%m-%d\') AND bespeak.status =\'agree\'  GROUP BY DATE_FORMAT(bespeak.updated_at ,\'%Y-%m-%d\') ) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql8 = 'UPDATE daily_report SET landingNum = (SELECT COUNT(*) FROM `user`  WHERE user.source = 2 AND daily_report.date =  DATE_FORMAT(user.created_at ,\'%Y-%m-%d\')   GROUP BY  DATE_FORMAT(user.created_at ,\'%Y-%m-%d\')) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql9 = 'UPDATE daily_report SET landing_page_uv = (SELECT COUNT(*) FROM `uuid2source`  WHERE uuid2source.pageId = 1 AND daily_report.date =  DATE_FORMAT(uuid2source.create_at ,\'%Y-%m-%d\')   GROUP BY  DATE_FORMAT(uuid2source.create_at ,\'%Y-%m-%d\')) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql10 = 'UPDATE daily_report SET pay_order_num  = (SELECT COUNT(*) FROM `order_log` WHERE order_log.old_value =5 AND order_log.new_value =2   AND daily_report.date = DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\') )  WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql11 = 'UPDATE daily_report SET work_complete_num  = (SELECT COUNT(*) FROM `order_log` WHERE order_log.old_value =6 AND order_log.new_value =7   AND daily_report.date = DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\')) WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql12 = 'UPDATE daily_report SET  payOrderRecordNum = (SELECT COUNT(*) FROM `order_log` WHERE order_log.old_value =5 AND order_log.new_value =2   AND daily_report.date = DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(order_log.created_at ,\'%Y-%m-%d\') )  WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql13 = 'UPDATE daily_report SET  payAccountCount = (SELECT SUM(amount) FROM `order`  WHERE  daily_report.date = DATE_FORMAT(order.paid_at,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(order.paid_at ,\'%Y-%m-%d\') )  WHERE  daily_report.date = ' + "'"+currdate+ "'";        sql14 = 'UPDATE daily_report SET  login_time = (SELECT count(*)  from user_log   WHERE  daily_report.date = DATE_FORMAT(user_log.created_at,\'%Y-%m-%d\')  GROUP BY DATE_FORMAT(user_log.created_at ,\'%Y-%m-%d\') )  WHERE  daily_report.date = ' + "'"+currdate+ "'";        cursor.execute(sql1)        cursor.execute(sql2)        cursor.execute(sql3)        cursor.execute(sql4)        cursor.execute(sql5)        cursor.execute(sql6)        cursor.execute(sql7)        cursor.execute(sql8)        cursor.execute(sql9)        cursor.execute(sql10)        cursor.execute(sql11)        cursor.execute(sql12)        cursor.execute(sql13)        cursor.execute(sql14)        conn.commit()    except Exception, e:        print e    cursor.close()    conn.close()currdate = time.strftime("%Y-%m-%d", time.localtime());print currdateupdateDailyReport(currdate)#updateDailyReport("2016-02-14")#updateDailyReport("2016-02-15")#updateDailyReport("2016-02-16")#updateDailyReport("2016-02-17")#updateDailyReport("2016-02-18")#updateDailyReport("2016-02-19")#updateDailyReport("2016-02-20")#updateDailyReport("2016-02-21")#updateDailyReport("2016-02-22")
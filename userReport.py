 # -*- coding: utf-8 -*-import confimport timeimport MySQLdbdef conndb():    return MySQLdb.connect(host = conf.mysql_host, user = conf.mysql_user, passwd = conf.mysql_pwd, db = conf.mysql_db, port = int(conf.mysql_port))def updateStatisticsyReport():    conn = conndb()    cursor = conn.cursor()    try:        cursor.execute('set names utf8')        insertSql  = "INSERT INTO user_statistics(user_id) SELECT user_id FROM user WHERE user_id > (SELECT IF(MAX(user_id) IS NULL ,0,MAX(user_id) ) FROM user_statistics )"        res = cursor.execute(insertSql)        print("新增记录成功: %s" % cursor.lastrowid)        sql1 = 'UPDATE user_statistics SET  loginCount = (SELECT count(id) FROM `user_log`  WHERE  user_log.user_id = user_statistics.user_id)';        cursor.execute(sql1)        sql2 = 'UPDATE user_statistics SET  demandCount = (SELECT count(demand_id) FROM `project_demand`  WHERE  project_demand.user_id = user_statistics.user_id)';        cursor.execute(sql2)        sql3 = 'UPDATE user_statistics SET  sendBespeakCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.sender_id = user_statistics.user_id)';        cursor.execute(sql3)        sql4 = 'UPDATE user_statistics SET  beAcceptCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.sender_id = user_statistics.user_id and status<>"delay" and status <> "send") ';        cursor.execute(sql4)        sql5 = 'UPDATE user_statistics SET  beRejectCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.sender_id = user_statistics.user_id AND STATUS="reject")';        cursor.execute(sql5)        sql6 = 'UPDATE user_statistics SET  beDelayCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.sender_id = user_statistics.user_id AND STATUS="delay")';        cursor.execute(sql6)        sql7 = 'UPDATE user_statistics SET  acceptCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.receiver_id = user_statistics.user_id AND status<>"delay" and status <> "send")';        cursor.execute(sql7)        sql8 = 'UPDATE user_statistics SET  rejectCount = (SELECT COUNT(bespeak_id) FROM `bespeak`  WHERE  bespeak.receiver_id = user_statistics.user_id AND STATUS="reject")';        cursor.execute(sql8)        conn.commit()    except Exception, e:        print e    cursor.close()    conn.close()#currdate = time.strftime("%Y-%m-%d", time.localtime());updateStatisticsyReport()